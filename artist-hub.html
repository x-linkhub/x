<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon"
  href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'><text x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-size='96'>🎵</text></svg>">
  <title>Artist Hub</title>
  <style>
    :root{
      --bg: #0b0f14;
      --surface: #121821;
      --surface-2: #151c26;
      --text: #e8eef6;
      --muted: #9fb0c3;
      --accent: #8b5cf6;
      --accent-2:#22d3ee;
      --card-radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 16px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 1200px at 80% -10%, rgba(139,92,246,.15), transparent 45%),
                  radial-gradient(900px 900px at 0% 10%, rgba(34,211,238,.12), transparent 40%),
                  var(--bg);
      color:var(--text);
      letter-spacing:.2px;
    }
    a{color:inherit}
    .container{max-width:1000px; margin:0 auto; padding:24px;}

    /* Header */
    header{
      position:sticky; top:0; z-index:10; backdrop-filter: blur(8px);
      background: color-mix(in oklab, var(--bg) 85%, transparent);
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .bar{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 24px;}
    .left, .right{display:flex; align-items:center; gap:10px}

    .btn{
      display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:12px;
      background: linear-gradient(180deg, var(--surface), var(--surface-2));
      border:1px solid rgba(255,255,255,.06);
      color:var(--text); text-decoration:none; cursor:pointer;
      transition:.2s transform,.2s background,.2s border-color, .2s opacity; box-shadow: var(--shadow);
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.12)}
    .btn:active{ transform: translateY(0)}
    .btn.primary{ background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 30%, var(--surface)), var(--surface-2)); border-color: color-mix(in oklab, var(--accent) 45%, rgba(255,255,255,.06)); }
    .btn.ghost{ background: transparent; border-color: rgba(255,255,255,.12)}

    /* Center title with shimmer */
    .title{ position:relative; font-weight:800; font-size: clamp(22px, 3.4vw, 38px); letter-spacing:.5px; text-transform:uppercase; background: linear-gradient(90deg, var(--accent), var(--accent-2)); -webkit-background-clip: text; background-clip:text; color: transparent; }
    .title .shimmer{position:absolute; inset:0; background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.7) 50%, transparent 100%); transform: skewX(-20deg) translateX(-120%); filter: blur(4px); mix-blend-mode: overlay; animation: shimmer 3.8s infinite;}
    @keyframes shimmer{ 60%{ transform: skewX(-20deg) translateX(120%) } 100%{ transform: skewX(-20deg) translateX(120%) } }

    /* Utility */
    .spacer{flex:1}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .muted{ color: var(--muted); font-size:.92rem }

    /* Search */
    .search{ width:100%; margin:18px 0 10px; display:flex; gap:10px; }
    .search input{ flex:1; padding:14px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.09); background: linear-gradient(180deg, var(--surface), var(--surface-2)); color:var(--text); outline:none; box-shadow: inset 0 2px 10px rgba(0,0,0,.25); }

    /* Cards */
    .list{ display:flex; flex-direction:column; gap:16px; }
    .card{ background: linear-gradient(180deg, color-mix(in oklab, var(--surface) 70%, #000), var(--surface-2)); border:1px solid rgba(255,255,255,.07); border-radius: var(--card-radius); box-shadow: var(--shadow); padding:16px 16px 14px; position:relative; overflow:hidden; }
    .card:hover{ border-color: rgba(255,255,255,.14)}
    .card .header{ display:flex; align-items:center; gap:10px; }
    .card h3{ margin:0; font-size:1.05rem; letter-spacing:.3px }

    .links{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .link-chip{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); text-decoration:none; }
    .link-chip:hover{ border-color: rgba(255,255,255,.16) }
    .link-chip svg{ width:18px; height:18px }

    .videos{ display:grid; grid-template-columns: 1fr; gap:10px; margin-top:12px }
    @media (min-width: 760px){ .videos{ grid-template-columns: 1fr 1fr } }
    .video{ position:relative; width:100%; padding-top:56.25%; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.08) }
    .video iframe{ position:absolute; inset:0; width:100%; height:100%; border:0 }

    /* Actions */
    .actions{ margin-left:auto; display:flex; gap:6px }
    .icon-btn{ background:transparent; border:1px solid rgba(255,255,255,.14); padding:8px; border-radius:10px; cursor:pointer; color:var(--text)}
    .icon-btn:hover{ border-color: rgba(255,255,255,.25) }

    footer{ opacity:.8; font-size:.9rem; padding:26px 0; }

    /* Modal (Add/Edit) */
    dialog{ border:0; border-radius:16px; background: linear-gradient(180deg, var(--surface), var(--surface-2)); color:var(--text); width:min(680px, 92vw); box-shadow: var(--shadow); }
    dialog::backdrop{ background: rgba(0,0,0,.5); backdrop-filter: blur(2px); }
    .modal-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08) }
    .modal-body{ padding:14px 16px 18px; display:grid; gap:12px }
    .field label{ display:block; font-size:.9rem; color:var(--muted); margin-bottom:6px }
    .field input, .field textarea{ width:100%; padding:12px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background: linear-gradient(180deg, var(--surface), var(--surface-2)); color:var(--text); outline:none; }

    .links-editor{ display:grid; gap:8px }
    .link-row{ display:grid; grid-template-columns: 1fr auto; gap:8px }
    .hidden{ display:none !important }

    /* Simple menu dialog */
    #menuDialog .modal-body{ gap:14px }
    .menu-row{ display:flex; align-items:center; justify-content:space-between; gap:10px }
  
/* Safer default: hide editing UI unless editor class is present */
#addBtn, #menuBtn, .actions { display: none !important; }
/* keep auth buttons always visible */
#loginBtn, #logoutBtn { display: inline-flex !important; }

body.editor #addBtn, body.editor #menuBtn { display: inline-flex !important; }
body.editor .actions { display: flex !important; }

</style>
</head>
<body>
  <header>
    <div class="bar">
      <div class="left">
        <a class="btn" href="index.html" title="Back to Link Hub">⟵ Link Hub</a>
      </div>
      <div class="spacer"></div>
      <div class="row">
        <h1 class="title" aria-label="Artist Hub">Artist Hub<div class="shimmer"></div></h1>
      </div>
      <div class="spacer"></div>
      <div class="right">
        <span id="userBadge" class="muted"></span>
        <button id="loginBtn" class="btn ghost" title="Sign in">Sign in</button>
        <button id="logoutBtn" class="btn ghost hidden" title="Sign out">Sign out</button>

        <button id="addBtn" class="btn primary" title="Add artist">＋ Add Artist</button>
        <button id="menuBtn" class="btn" title="Menu">☰ Menu</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="search">
      <input id="searchInput" type="search" placeholder="Search artists… (name or platform)"/>
    </div>

    <section id="list" class="list" aria-live="polite"></section>

    <footer class="container">
      <div class="muted">2025.<strong>AH - 1v</strong>형세</div>
    </footer>
  </main>

  <!-- Add/Edit Modal -->
  <dialog id="artistDialog">
    <form id="artistForm" method="dialog">
      <div class="modal-head">
        <strong id="dialogTitle">Add Artist</strong>
        <div class="row">
          <button type="button" id="cancelDialog" class="btn ghost">Cancel</button>
          <button type="submit" class="btn primary">Save</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="field">
          <label for="artistName">Artist name</label>
          <input id="artistName" required placeholder="e.g., Nøxcrya"/>
        </div>

        <div class="field">
          <label>Platform links <small>(paste URLs – icons auto-detect & colored)</small></label>
          <div id="linksEditor" class="links-editor"></div>
          <div class="row">
            <button type="button" id="addLinkRow" class="btn">＋ Add link</button>
            <span class="muted">Examples: https://youtube.com/@name • https://open.spotify.com/artist/… • https://soundcloud.com/…</span>
          </div>
        </div>

        <div class="field">
          <label for="videos">Featured YouTube videos <small>(one URL per line)</small></label>
          <textarea id="videos" rows="4" placeholder="https://youtu.be/xxxxxxxxxxx&#10;https://www.youtube.com/watch?v=xxxxxxxxxxx"></textarea>
        </div>

        <input type="hidden" id="editingId" />
      </div>
    </form>
  </dialog>

  <!-- Menu Modal (Import/Export) -->
  <dialog id="menuDialog">
    <div class="modal-head">
      <strong>Menu</strong>
      <button type="button" id="closeMenu" class="btn ghost">Close</button>
    </div>
    <div class="modal-body">
      <div class="menu-row">
        <div>
          <div><strong>Export JSON</strong></div>
          <div class="muted">Download your artists as a backup file.</div>
        </div>
        <button id="exportBtn" class="btn">⇩ Export</button>
      </div>
      <div class="menu-row">
        <div>
          <div><strong>Import JSON</strong></div>
          <div class="muted">Restore from a file exported earlier.</div>
        </div>
        <div>
          <label class="btn" for="importFile">Import…</label>
          <input id="importFile" class="hidden" type="file" accept="application/json"/>
        </div>
      </div>
    </div>
  </dialog>

  <template id="linkRowTpl">
    <div class="link-row">
      <input type="url" placeholder="Paste platform URL" />
      <button type="button" class="btn ghost remove-link">✕</button>
    </div>
  </template>

  
<script type="module">
  // Firebase (modular v11)
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, setPersistence, browserLocalPersistence, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
  import { getFirestore, doc, getDoc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

  // --- Your Firebase config ---
  const firebaseConfig = {

  apiKey: "AIzaSyBvWLRZjEyldAYZXfK6KV2H9_P5fLOsGMw",
  authDomain: "link-library-1dfc8.firebaseapp.com",
  projectId: "link-library-1dfc8",
  storageBucket: "link-library-1dfc8.firebasestorage.app",
  messagingSenderId: "368329977627",
  appId: "1:368329977627:web:625d20247d6aea3b9cadbe"

  };

  // --- Init (guarded) ---
  if (!getApps().length) initializeApp(firebaseConfig);
  const auth = getAuth();
  await setPersistence(auth, browserLocalPersistence);
  const db = getFirestore();
  // Expose for console debugging
  window.auth = auth; window.db = db;
  // --- Auth UI controls ---
  const loginBtn  = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const userBadge = document.getElementById("userBadge");

  function updateAuthUI(u) {
    if (u) {
      if (userBadge) userBadge.textContent = u.email || u.uid;
      if (loginBtn) loginBtn.classList.add("hidden");
      if (logoutBtn) logoutBtn.classList.remove("hidden");
    } else {
      if (userBadge) userBadge.textContent = "";
      if (loginBtn) loginBtn.classList.remove("hidden");
      if (logoutBtn) logoutBtn.classList.add("hidden");
    }
  }

  loginBtn && loginBtn.addEventListener("click", async () => {
    try {
      await signInWithPopup(auth, new GoogleAuthProvider());
    } catch (e) {
      console.error(e);
      alert("Sign-in failed: " + (e && e.message ? e.message : e));
    }
  });
  logoutBtn && logoutBtn.addEventListener("click", async () => {
    try { await signOut(auth); } catch (e) { console.error(e); }
  });


  // --- Collection/doc refs ---
  const DATA_DOC = doc(db, "artistHub", "data");

  // --- Editor gating ---
  const ALLOWED_EMAILS = ["xq.dannybs@gmail.com","dafuke88@gmail.com"];
  const __ALLOWED = new Set(ALLOWED_EMAILS.map(e => (e || "").toLowerCase()));
  function applyEditor(u) {
    const on = !!u && __ALLOWED.has((u.email || "").toLowerCase());
    document.body.classList.toggle("editor", on);
    // Optional: reveal any [data-editor-only] elements
    document.querySelectorAll("[data-editor-only]").forEach(el => el.hidden = !on);
  }
  applyEditor(auth.currentUser);
  onAuthStateChanged(auth, (u) => {
    applyEditor(u);
    updateAuthUI(u);
  });

  // --- State ---
  const STORAGE_KEY = "artistHub.v1";
  const state = { artists: [], filter: "" };
  window.__state = state;

  // --- Elements (guard each usage) ---
  const els = {
    list: document.getElementById("list"),
    addBtn: document.getElementById("addBtn"),
    menuBtn: document.getElementById("menuBtn"),
    menuDialog: document.getElementById("menuDialog"),
    closeMenu: document.getElementById("closeMenu"),
    exportBtn: document.getElementById("exportBtn"),
    importFile: document.getElementById("importFile"),
    search: document.getElementById("searchInput"),
    dialog: document.getElementById("artistDialog"),
    form: document.getElementById("artistForm"),
    dialogTitle: document.getElementById("dialogTitle"),
    cancelDialog: document.getElementById("cancelDialog"),
    name: document.getElementById("artistName"),
    linksEditor: document.getElementById("linksEditor"),
    addLinkRow: document.getElementById("addLinkRow"),
    videos: document.getElementById("videos"),
    editingId: document.getElementById("editingId"),
  };

  // --- Local cache helpers ---
  function saveLocal() { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state.artists)); } catch {} }
  function loadLocal() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) state.artists = JSON.parse(raw);
    } catch {}
  }

  // --- Cloud save (silent if not editor) ---
  async function saveCloud() {
    try {
      const u = auth.currentUser;
      const isEditor = !!u && __ALLOWED.has((u.email || "").toLowerCase());
      if (!isEditor) return;
      await setDoc(DATA_DOC, { artists: state.artists }, { merge: true });
    } catch (e) {
      console.error("Save failed:", e);
    }
  }
  function save() { saveLocal(); saveCloud(); }

  // --- Render ---
  function render() {
    if (!els.list) return;
    const term = state.filter.trim().toLowerCase();
    const items = !term ? state.artists : state.artists.filter(a =>
      (a.name || "").toLowerCase().includes(term) ||
      (a.links || []).some(l => (l.platform || "").toLowerCase().includes(term))
    );

    els.list.innerHTML = "";
    if (!items.length) {
      const empty = document.createElement("div");
      empty.className = "card muted";
      empty.style.textAlign = "center";
      empty.style.padding = "30px";
      empty.textContent = "No artists yet. Click “Add Artist” to create your first one!";
      els.list.appendChild(empty);
      return;
    }
    for (const a of items) els.list.appendChild(artistCard(a));
  }
  window.__render = render;

  function artistCard(a) {
    const card = document.createElement("article");
    card.className = "card";
    card.dataset.id = a.id;

    const head = document.createElement("div"); head.className = "header";
    const title = document.createElement("h3"); title.textContent = a.name || "Untitled";
    head.appendChild(title);

    const actions = document.createElement("div"); actions.className = "actions";
    actions.appendChild(iconButton("↑","Move up","move-up"));
    actions.appendChild(iconButton("↓","Move down","move-down"));
    actions.appendChild(iconButton("✎","Edit","edit"));
    actions.appendChild(iconButton("🗑","Delete","delete"));
    head.appendChild(actions);
    card.appendChild(head);

    if ((a.links || []).length) {
      const links = document.createElement("div"); links.className = "links";
      a.links.forEach(link => {
        const chip = document.createElement("a");
        chip.className = "link-chip";
        chip.href = link.url; chip.target = "_blank"; chip.rel = "noopener noreferrer";
        chip.title = link.url || "";
        chip.innerHTML = iconSVG(link.platform) + `<span>${link.platform || "Link"}</span>`;
        links.appendChild(chip);
      });
      card.appendChild(links);
    }

    if ((a.videos || []).length) {
      const videos = document.createElement("div"); videos.className = "videos";
      a.videos.forEach(id => {
        const wrap = document.createElement("div"); wrap.className = "video";
        wrap.innerHTML = `<iframe loading="lazy" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen src="https://www.youtube-nocookie.com/embed/${id}"></iframe>`;
        videos.appendChild(wrap);
      });
      card.appendChild(videos);
    }

    return card;
  }

  function iconButton(label, title, action) {
    const b = document.createElement("button");
    b.className = "icon-btn"; b.title = title; b.dataset.action = action; b.textContent = label;
    return b;
  }

  // --- Dialog (Add/Edit) wiring ---
  function openAdd() {
    if (!els.dialog) return;
    els.dialogTitle && (els.dialogTitle.textContent = "Add Artist");
    els.name && (els.name.value = "");
    els.videos && (els.videos.value = "");
    els.editingId && (els.editingId.value = "");
    resetLinksEditor(); addLinkInput();
    els.dialog.showModal();
    setTimeout(() => els.name && els.name.focus(), 0);
  }
  function openEdit(id) {
    if (!els.dialog) return;
    const a = state.artists.find(x => x.id === id);
    if (!a) return;
    els.dialogTitle && (els.dialogTitle.textContent = "Edit Artist");
    els.name && (els.name.value = a.name || "");
    if (els.videos) els.videos.value = (a.videos || []).map(v => `https://youtu.be/${v}`).join("
");
    els.editingId && (els.editingId.value = id);
    resetLinksEditor();
    if ((a.links || []).length) a.links.forEach(l => addLinkInput(l.url)); else addLinkInput();
    els.dialog.showModal();
    setTimeout(() => els.name && els.name.focus(), 0);
  }

  function resetLinksEditor(){ if (els.linksEditor) els.linksEditor.innerHTML = ""; }
  function addLinkInput(value="") {
    const tpl = document.getElementById("linkRowTpl");
    if (!tpl || !els.linksEditor) return;
    const node = tpl.content.firstElementChild.cloneNode(true);
    const input = node.querySelector("input");
    if (input) { input.value = value; input.placeholder = exampleFor(value); }
    const rm = node.querySelector(".remove-link"); if (rm) rm.addEventListener("click", () => node.remove());
    els.linksEditor.appendChild(node);
  }

  // --- Toolbar listeners (guarded) ---
  els.addBtn && els.addBtn.addEventListener("click", openAdd);
  els.menuBtn && els.menuBtn.addEventListener("click", () => els.menuDialog && els.menuDialog.showModal());
  els.closeMenu && els.closeMenu.addEventListener("click", () => els.menuDialog && els.menuDialog.close());

  // Export
  els.exportBtn && els.exportBtn.addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(state.artists, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a"); a.href = url; a.download = "artist-hub-export.json"; a.click();
    setTimeout(()=> URL.revokeObjectURL(url), 2000);
  });
  // Import
  els.importFile && els.importFile.addEventListener("change", (e) => {
    const file = e.target.files?.[0]; if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const data = JSON.parse(reader.result);
        if (Array.isArray(data)) {
          state.artists = data.map(x => ({
            id: x.id || uid(),
            name: String(x.name || "Untitled"),
            links: (x.links || []).map(l => ({ platform: l.platform || detectPlatform(l.url || ""), url: String(l.url || "") })),
            videos: (x.videos || []).filter(Boolean)
          }));
          save(); render(); alert("Import complete.");
        } else { alert("Invalid JSON format: expected an array"); }
      } catch(err) { alert("Import failed: " + (err?.message || err)); }
      finally { e.target.value = ""; }
    };
    reader.readAsText(file);
  });

  // Search
  els.search && els.search.addEventListener("input", () => { state.filter = els.search.value; render(); });
  els.search && els.search.addEventListener("search", () => { state.filter = els.search.value; render(); });

  // List actions
  els.list && els.list.addEventListener("click", (e) => {
    const btn = e.target.closest("button.icon-btn");
    if (!btn) return;
    const card = e.target.closest(".card");
    const id = card?.dataset.id; if (!id) return;
    const action = btn.dataset.action;
    const ix = state.artists.findIndex(a => a.id === id);
    if (ix < 0) return;
    if (action === "delete") {
      if (confirm("Delete this artist?")) { state.artists.splice(ix,1); save(); render(); }
    } else if (action === "edit") {
      openEdit(id);
    } else if (action === "move-up") {
      if (ix > 0) { const [it] = state.artists.splice(ix,1); state.artists.splice(ix-1,0,it); save(); render(); }
    } else if (action === "move-down") {
      if (ix < state.artists.length-1) { const [it] = state.artists.splice(ix,1); state.artists.splice(ix+1,0,it); save(); render(); }
    }
  });

  // --- Helpers ---
  function uid(){ return Math.random().toString(36).slice(2, 10) + Date.now().toString(36).slice(-4); }
  function detectPlatform(url){
    try{
      const u = new URL(url); const h = u.hostname.replace("www.","");
      if (h.includes("youtube") || h.includes("youtu.be")) return "YouTube";
      if (h.includes("open.spotify.com")) return "Spotify";
      if (h.includes("soundcloud.com")) return "SoundCloud";
      if (h.includes("music.apple.com")) return "Apple Music";
      if (h.includes("bandcamp.com")) return "Bandcamp";
      if (h.includes("instagram.com")) return "Instagram";
      if (h.includes("tiktok.com")) return "TikTok";
      if (h === "x.com" || h.includes("twitter.com")) return "X";
      if (h.includes("deezer.com")) return "Deezer";
      if (h.includes("tidal.com")) return "Tidal";
      return "Website";
    }catch{ return "Website"; }
  }
  function exampleFor(v){
    const p = detectPlatform(v);
    const map = {
      "YouTube": "https://www.youtube.com/@channel",
      "Spotify": "https://open.spotify.com/artist/…",
      "SoundCloud": "https://soundcloud.com/artist",
      "Apple Music": "https://music.apple.com/artist/…",
      "Bandcamp": "https://artist.bandcamp.com",
      "Instagram": "https://instagram.com/…",
      "TikTok": "https://www.tiktok.com/@…",
      "X": "https://x.com/…",
      "Deezer": "https://www.deezer.com/artist/…",
      "Tidal": "https://tidal.com/browse/artist/…",
      "Website": "https://your-site.com"
    };
    return map[p] || "https://…";
  }
  function parseYouTubeId(input){
    if (/^[a-zA-Z0-9_-]{11}$/.test(input)) return input;
    try{
      const u = new URL(input);
      if (u.hostname.includes("youtu.be")) return u.pathname.split("/")[1] || "";
      if (u.searchParams.get("v")) return u.searchParams.get("v");
      const m = u.pathname.match(/\/embed\/([a-zA-Z0-9_-]{11})/); if (m) return m[1];
    }catch{}
    return "";
  }
  function iconSVG(platform){
    const colorMap = {
      "YouTube":"#FF0000","Spotify":"#1DB954","SoundCloud":"#FF5500","Apple Music":"#FA2A55","Bandcamp":"#629AA9",
      "Instagram":"#E4405F","TikTok":"#EE1D52","X":"#1D9BF0","Deezer":"#EF5466","Tidal":"#01FFFF","Website":"#9fb0c3"
    };
    const fill = colorMap[platform] || "#9fb0c3";
    // minimal generic icon for all
    return `<svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="${fill}"/></svg>`;
  }

  // --- Boot: load local, render, then subscribe to Firestore ---
  loadLocal();
  render();
  onSnapshot(DATA_DOC, (snap) => {
    const data = snap.exists() ? (snap.data() || {}) : {};
    const arr = Array.isArray(data.artists) ? data.artists : [];
    state.artists = arr;
    saveLocal(); // cache
    render();
  });

  // --- Public helpers (optional) ---
  window.signInWithGoogle = async () => { await signInWithPopup(auth, new GoogleAuthProvider()); };
  window.signOutApp = async () => { await signOut(auth); };
</script>

</body>
</html>
